<?php 	$title = "Webpage Create";		$css = "	<link rel='stylesheet' type='text/css' href='css/index.css'>";		$js = "	<script type='text/javascript' src='js/index.js'></script>";		require($_SERVER['DOCUMENT_ROOT']."/manager/header.php");	?><div id='main'>		<h1>Create a Web Page</h1>		<?php 		$rPath = $_SERVER['REQUEST_URI'];		if ($_POST) {				$type = $_POST["page-type"];		$name = $_POST["page-name"];		$path = $_POST["path"];		$title = $_POST["title"];		$description = $_POST["description"];		$keywords = $_POST["keywords"];		$includes = $_POST["file-includes"];				// make sure we have a page name, if not default to index		if (!isset($name) || trim($name) === "") {						$name = "index";			$type = "index";		}				// make sure the path starts and ends with a '/'		$pathlen = strlen($path);		$start = substr($path, 0, 1);		$end = substr($path, $pathlen-1, 1);		if ($start !== "/") $path = "/".$path;		if ($end !== "/") $path = $path."/";					// create initial directory		createDir($_SERVER["DOCUMENT_ROOT"].$path);					// different types of pages		switch ($type) {						case "index": // if we are creating a home page, it needs css and a js file							// make sure the user is not trying to delete the web page maker				if (stripos($path.$name.".php", $rPath."index.php") === false) {										$webpage = new WebPage($path, $name);					$webpage->setHeader("Title", $title);					$webpage->setHeader("Description", $description);					$webpage->setHeader("Keywords", $keywords);										// since we are in an index we force these for now					$webpage->setInclude("PHP", "/manager/header.php");					$webpage->setInclude("PHP", "/manager/footer.php");										$links = array();					$js = array();					$html = array();					$php = array();										// categorize each include					foreach ($includes as $incPath) {												$pathinfo = pathinfo($incPath);						$ext = strtolower($pathinfo["extension"]);												// include files according to file type						switch ($ext) {														case "css":								$links[] = $incPath;							break;														case "js":								$js[] = $incPath;							break;														case "html":								$html[] = $incPath;							break;														case "php":								$php[] = $incPath;							break;						}					}										// add links css					foreach ($links as $link) {												$linkArray = $webpage->getHeader("Links");						$linkArray[] = $link;						$webpage->setHeader("Links", $linkArray);					}										// add js					foreach ($js as $j) {												$jsArray = $webpage->getHeader("JS");						$jsArray[] = $j;						$webpage->setHeader("JS", $jsArray);					}										// add html					foreach ($html as $h) {												$webpage->setInclude("HTML", $h);					}										// add php					foreach ($php as $p) {												$webpage->setInclude("PHP", $p);					}										$includes[] = $name.".php";										foreach ($includes as $filename) {												$webpage->createFile($filename);					}				}				else echo "<div class='ui-state-error'>You cannot overwrite the web page creator index page, that would be madness!</div>";							break;						case "form-landing-page":							// create file				$result = fopen($_SERVER["DOCUMENT_ROOT"].$path.$name.".flp.php", "w");				fwrite($result, "<?php \r\r?>");				fclose($result);								if ($result) echo "<div>Successfully created file [".$_SERVER["DOCUMENT_ROOT"].$path.$name.".flp.php]</div>";				else echo "<div class='ui-state-error'>Failed to create file [".$_SERVER["DOCUMENT_ROOT"].$path.$name.".php]</div>";			break;						default: // create php page							// make sure the user is not trying to delete the web page maker				if (stripos($path.$name.".php", $rPath."index.php") === false) {										// create file					$result = fopen($_SERVER["DOCUMENT_ROOT"].$path.$name.".php", "w");					fwrite($result, "<?php \r\r?>");					fclose($result);										if ($result) echo "<div>Successfully created file [".$_SERVER["DOCUMENT_ROOT"].$path.$name.".php]</div>";					else echo "<div class='ui-state-error'>Failed to create file [".$_SERVER["DOCUMENT_ROOT"].$path.$name.".php]</div>";				}				else echo "<div class='ui-state-error'>You cannot overwrite the web page creator index page, that would be madness!</div>";						break;		}	}	else {				// if we are on an index.php dont display the file name		if (strpos($rPath, ".") !== false) {						$exrPath = explode("/", $rPath);			$countPath = count($exrPath);						array_pop($exrPath);			$rPath = implode("/", $exrPath)."/";		}			?>	<!-- FORM FOR CREATING WEB PAGE -->	<!-- POSTS TO THIS PAGE -->	<form method="POST" action="" id='page-create-form' enctype="application/x-www-form-urlencoded">			<div class='form-row'>			<label for="page-type">Type of Page</label>			<select name="page-type" id="page-type">				<option value="index">Home/Index</option>				<option value="form-landing-page">Form Landing Page</option>				<option value="other">Other</option>			</select>		</div>			<div class='form-row'>			<label for="page-name">Page Name</label>			<input type="text" name="page-name" id="page-name" info='Give your page a name.'/>		</div>				<div class='form-row'>			<label for="path">Path</label>			<input type="text" name="path" id="path" value="<?php echo $rPath; ?>"/>			<button type='button' id='relative-path-button'></button>		</div>				<div class='form-row'>			<label for="title">Title</label>			<input type="text" name="title" id="title"/>		</div>				<div class='form-row'>			<label for="description">Description</label>			<textarea name="description" id="description" rows="5"></textarea>		</div>				<div class='form-row'>			<label for="keywords">Keywords</label>			<input name="keywords" id="keywords" />		</div>				<div class='form-row'>			<label for="file-includes">File Includes</label>			<select name="file-includes[]" id="file-includes" size="5" multiple="multiple" info="These are pages that will be loaded into this page. When creating certain pages, it will require some pages and will disable them.">				<option value='css/index.css' disabled>css/index.css</option>				<option value='js/index.js' disabled>js/index.js</option>			</select>			<div id='include-option-container'>				<button type='button' id='add-file-include' info="Include File"></button><br><br>				<button type='button' id='remove-file-include' info="Delete Selected" disabled></button>			</div>		</div>				<div class='form-row submit-container'>			<button type='submit' id="submit">Submit Form</button>		</div>	</form>	<?php 	}		function createDir ($path) {				// if the path does not exist create it		if (!file_exists($path)) {						$result = mkdir($path);						if ($result) echo "<div>Successfully created directory [".$path."]</div>";			else echo "<div class='ui-state-error'>Failed to create directory [".$path."]</div>";						return $result;		}		else return false;	}	?></div>